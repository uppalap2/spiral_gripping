%% Optimization for fitting parameters
function [x,f] = opti_fit_50_88
n = 2;%default change to 2 for corrected angles
lb = [0 0];
ub = [1 1];
opts = optimoptions('fmincon'                ,...
                           'Display'                ,'iter',...
                           'Algorithm'              ,'interior-point',... % use active-set or sqp only, interiror point doesn't satisfy the constraints
                           'MaxFunctionEvaluations' ,10e3,...
                           'MaxIter'                ,180,...
                           'TolFun'                 , 1e-12);
% [x,fval,exitflag] = fmincon(@fun,[.24 .2],[],[],[],[],lb,ub,[],opts)


problem = createOptimProblem('fmincon','objective',...
 @(x)fun(x,n),'x0',[0 0],'lb',lb,'ub',ub,'options',opts);
ms = MultiStart;
[x,f] = run(ms,problem,20);
end

function w = fun(x,n)
% lambda1_exp =  [  1 1.0220 1.0330 1.0549 1.0769 1.1099 1.1209 1.1538 ...
%                     1.1978 1.2418  ];
% P_exp = 0:2:18;
lambda1_exp = [1 1.0490 1.0703 1.0935 1.1211];
P_exp = [0 7.1 10 12.2 14.1];
C1 = x(1); C2 = x(2);lambda1 = lambda1_exp;

switch n
    case 1 %(this is wrong not changed form 60,88)
%% for 88,60
P_anal = lambda1.^(-3).*(C2.*(0.113499E9+(-0.925926E0).*lambda1.^12+ ...
  lambda1.^6.*(0.589272E8+(-0.481951E7).*((-1).*((-4)+lambda1.^2).*( ...
  2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^10.*( ...
  0.133686E4+(-0.187604E2).*((-1).*((-4)+lambda1.^2).*(2+ ...
  lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^8.*(( ...
  -0.55452E6)+0.193475E5.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*( ...
  (-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^2.*((-0.28788E8)+ ...
  0.140044E7.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2))+lambda1.^4.*((-0.201449E9)+0.174455E9.*((-1) ...
  .*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^( ...
  1/2))+(-0.147214E9).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*(( ...
  -1)+cos((1/45).*pi)))).^(1/2))+C1.*(0.497884E8+0.833144E2.* ...
  lambda1.^10+lambda1.^6.*(0.286096E8+(-0.13927E7).*((-1).*((-4)+ ...
  lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+ ...
  lambda1.^8.*((-0.103106E6)+0.168805E4.*((-1).*((-4)+lambda1.^2).*( ...
  2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^2.*(( ...
  -0.187616E8)+0.614331E6.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.* ...
  ((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^4.*((-0.104873E9)+ ...
  0.146009E9.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2))+(-0.126711E9).*((-1).*((-4)+lambda1.^2).*(2+ ...
  lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))).*(0.109471E4+0.1E1.* ...
  lambda1.^4+lambda1.^2.*((-0.550023E3)+0.202612E2.*((-1).*((-4)+ ...
  lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+( ...
  -0.278604E4).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2)).^(-1).*(0.412518E3+(-0.1E1).*lambda1.^2+( ...
  -0.202612E2).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2)).^(-2);

    case 2
%% for corrected 46,87 (50,88)
P_anal= lambda1.^(-3).*(0.169803E3+(-0.1E1).*lambda1.^2+(-0.131042E2).*(4+ ...
  (-0.197768E1).*lambda1.^2+0.582345E-2.*lambda1.^4).^(1/2)).^(-2).* ...
  (0.228959E3+0.1E1.*lambda1.^4+(-0.74171E3).*(4+(-0.197768E1).* ...
  lambda1.^2+0.582345E-2.*lambda1.^4).^(1/2)+lambda1.^2.*(( ...
  -0.226404E3)+0.131042E2.*(4+(-0.197768E1).*lambda1.^2+ ...
  0.582345E-2.*lambda1.^4).^(1/2))).^(-1).*(C1.*((-0.179211E7)+( ...
  -0.342919E2).*lambda1.^10+0.58055E7.*(4+(-0.197768E1).*lambda1.^2+ ...
  0.582345E-2.*lambda1.^4).^(1/2)+lambda1.^4.*(0.344122E7+( ...
  -0.658995E7).*(4+(-0.197768E1).*lambda1.^2+0.582345E-2.* ...
  lambda1.^4).^(1/2))+lambda1.^2.*(0.132908E7+(-0.683793E5).*(4+( ...
  -0.197768E1).*lambda1.^2+0.582345E-2.*lambda1.^4).^(1/2))+ ...
  lambda1.^8.*(0.174686E5+(-0.449367E3).*(4+(-0.197768E1).* ...
  lambda1.^2+0.582345E-2.*lambda1.^4).^(1/2))+lambda1.^6.*(( ...
  -0.199778E7)+0.152608E6.*(4+(-0.197768E1).*lambda1.^2+ ...
  0.582345E-2.*lambda1.^4).^(1/2)))+C2.*((-0.40536E7)+0.925926E0.* ...
  lambda1.^12+0.672219E7.*(4+(-0.197768E1).*lambda1.^2+0.582345E-2.* ...
  lambda1.^4).^(1/2)+lambda1.^4.*(0.73566E7+(-0.799004E7).*(4+( ...
  -0.197768E1).*lambda1.^2+0.582345E-2.*lambda1.^4).^(1/2))+ ...
  lambda1.^2.*(0.202805E7+(-0.154668E6).*(4+(-0.197768E1).* ...
  lambda1.^2+0.582345E-2.*lambda1.^4).^(1/2))+lambda1.^8.*( ...
  0.940764E5+(-0.515076E4).*(4+(-0.197768E1).*lambda1.^2+ ...
  0.582345E-2.*lambda1.^4).^(1/2))+lambda1.^10.*((-0.550287E3)+ ...
  0.121335E2.*(4+(-0.197768E1).*lambda1.^2+0.582345E-2.*lambda1.^4) ...
  .^(1/2))+lambda1.^6.*((-0.414468E7)+0.528936E6.*(4+(-0.197768E1).* ...
  lambda1.^2+0.582345E-2.*lambda1.^4).^(1/2))));
end

w = sqrt(abs((P_anal*145.08-P_exp))*abs((P_anal*145.08-P_exp))');

end


