%% Optimization for fitting parameters
function [x,f] = opti_fit_70_88
n = 2;%default change to 2 for corrected angles
lb = [0 0];
ub = [1 0];
opts = optimoptions('fmincon'                ,...
                           'Display'                ,'iter',...
                           'Algorithm'              ,'interior-point',... % use active-set or sqp only, interiror point doesn't satisfy the constraints
                           'MaxFunctionEvaluations' ,10e3,...
                           'MaxIter'                ,180,...
                           'TolFun'                 , 1e-12);
% [x,fval,exitflag] = fmincon(@fun,[.24 .2],[],[],[],[],lb,ub,[],opts)


problem = createOptimProblem('fmincon','objective',...
 @(x)fun(x,n),'x0',[0 0],'lb',lb,'ub',ub,'options',opts);
ms = MultiStart;
[x,f] = run(ms,problem,20);
end

function w = fun(x,n)
lambda1_exp =   [  1.0000    1.0222    1.0667    1.1000    1.1111    1.1333   ...
                    1.1778    1.2222    1.2556    1.3222];
P_exp = 0:2:18;
C1 = x(1); C2 = x(2);lambda1 = lambda1_exp;

switch n
    case 1 %(this is wrong not changed form 60,88)
%% for 88,60
P_anal = lambda1.^(-3).*(C2.*(0.113499E9+(-0.925926E0).*lambda1.^12+ ...
  lambda1.^6.*(0.589272E8+(-0.481951E7).*((-1).*((-4)+lambda1.^2).*( ...
  2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^10.*( ...
  0.133686E4+(-0.187604E2).*((-1).*((-4)+lambda1.^2).*(2+ ...
  lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^8.*(( ...
  -0.55452E6)+0.193475E5.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*( ...
  (-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^2.*((-0.28788E8)+ ...
  0.140044E7.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2))+lambda1.^4.*((-0.201449E9)+0.174455E9.*((-1) ...
  .*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^( ...
  1/2))+(-0.147214E9).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*(( ...
  -1)+cos((1/45).*pi)))).^(1/2))+C1.*(0.497884E8+0.833144E2.* ...
  lambda1.^10+lambda1.^6.*(0.286096E8+(-0.13927E7).*((-1).*((-4)+ ...
  lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+ ...
  lambda1.^8.*((-0.103106E6)+0.168805E4.*((-1).*((-4)+lambda1.^2).*( ...
  2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^2.*(( ...
  -0.187616E8)+0.614331E6.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.* ...
  ((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^4.*((-0.104873E9)+ ...
  0.146009E9.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2))+(-0.126711E9).*((-1).*((-4)+lambda1.^2).*(2+ ...
  lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))).*(0.109471E4+0.1E1.* ...
  lambda1.^4+lambda1.^2.*((-0.550023E3)+0.202612E2.*((-1).*((-4)+ ...
  lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+( ...
  -0.278604E4).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2)).^(-1).*(0.412518E3+(-0.1E1).*lambda1.^2+( ...
  -0.202612E2).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2)).^(-2);

    case 2
%% for corrected 65,86 (70,88)
P_anal= lambda1.^(-3).*(0.148534E3+(-0.1E1).*lambda1.^2+(-0.20813E2).*(4+( ...
  -0.685783E0).*lambda1.^2+0.230851E-2.*lambda1.^4).^(1/2)).^(-2).*( ...
  0.577572E3+0.1E1.*lambda1.^4+(-0.103047E4).*(4+(-0.685783E0).* ...
  lambda1.^2+0.230851E-2.*lambda1.^4).^(1/2)+lambda1.^2.*(( ...
  -0.198045E3)+0.20813E2.*(4+(-0.685783E0).*lambda1.^2+0.230851E-2.* ...
  lambda1.^4).^(1/2))).^(-1).*(C1.*((-0.241032E7)+(-0.249144E2).* ...
  lambda1.^10+0.430037E7.*(4+(-0.685783E0).*lambda1.^2+0.230851E-2.* ...
  lambda1.^4).^(1/2)+lambda1.^4.*(0.605986E7+(-0.612037E7).*(4+( ...
  -0.685783E0).*lambda1.^2+0.230851E-2.*lambda1.^4).^(1/2))+ ...
  lambda1.^2.*(0.61986E6+(-0.579044E5).*(4+(-0.685783E0).* ...
  lambda1.^2+0.230851E-2.*lambda1.^4).^(1/2))+lambda1.^8.*( ...
  0.111019E5+(-0.518543E3).*(4+(-0.685783E0).*lambda1.^2+ ...
  0.230851E-2.*lambda1.^4).^(1/2))+lambda1.^6.*((-0.114015E7)+ ...
  0.154042E6.*(4+(-0.685783E0).*lambda1.^2+0.230851E-2.*lambda1.^4) ...
  .^(1/2)))+C2.*((-0.653129E7)+0.925926E0.*lambda1.^12+0.628398E7.*( ...
  4+(-0.685783E0).*lambda1.^2+0.230851E-2.*lambda1.^4).^(1/2)+ ...
  lambda1.^4.*(0.138163E8+(-0.978227E7).*(4+(-0.685783E0).* ...
  lambda1.^2+0.230851E-2.*lambda1.^4).^(1/2))+lambda1.^2.*( ...
  0.116373E7+(-0.156904E6).*(4+(-0.685783E0).*lambda1.^2+ ...
  0.230851E-2.*lambda1.^4).^(1/2))+lambda1.^8.*(0.731022E5+( ...
  -0.715607E4).*(4+(-0.685783E0).*lambda1.^2+0.230851E-2.* ...
  lambda1.^4).^(1/2))+lambda1.^10.*((-0.481359E3)+0.192713E2.*(4+( ...
  -0.685783E0).*lambda1.^2+0.230851E-2.*lambda1.^4).^(1/2))+ ...
  lambda1.^6.*((-0.304356E7)+0.654445E6.*(4+(-0.685783E0).* ...
  lambda1.^2+0.230851E-2.*lambda1.^4).^(1/2))));
end

w = sqrt(abs((P_anal*145.08-P_exp))*abs((P_anal*145.08-P_exp))');

end


