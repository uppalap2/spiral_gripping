%% Optimization for fitting parameters
function [x,f] = opti_fit
n = 2;%default change to 2 for corrected angles
lb = [0 0];
ub = [1 1];
opts = optimoptions('fmincon'                ,...
                           'Display'                ,'iter',...
                           'Algorithm'              ,'interior-point',... % use active-set or sqp only, interiror point doesn't satisfy the constraints
                           'MaxFunctionEvaluations' ,10e3,...
                           'MaxIter'                ,180,...
                           'TolFun'                 , 1e-12);
% [x,fval,exitflag] = fmincon(@fun,[.24 .2],[],[],[],[],lb,ub,[],opts)


problem = createOptimProblem('fmincon','objective',...
 @(x)fun(x,n),'x0',[0 0],'lb',lb,'ub',ub,'options',opts);
ms = MultiStart;
[x,f] = run(ms,problem,20);
end

function w = fun(x,n)
lambda1_exp =  [  1.0250 1.0400 1.0700 1.1000 1.1450 1.2200 1.3000 1.4000];
P_exp = 3:3:24;
C1 = x(1); C2 = x(2);lambda1 = lambda1_exp;

switch n
    case 1
%% for 88,60
P_anal = lambda1.^(-3).*(C2.*(0.113499E9+(-0.925926E0).*lambda1.^12+ ...
  lambda1.^6.*(0.589272E8+(-0.481951E7).*((-1).*((-4)+lambda1.^2).*( ...
  2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^10.*( ...
  0.133686E4+(-0.187604E2).*((-1).*((-4)+lambda1.^2).*(2+ ...
  lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^8.*(( ...
  -0.55452E6)+0.193475E5.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*( ...
  (-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^2.*((-0.28788E8)+ ...
  0.140044E7.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2))+lambda1.^4.*((-0.201449E9)+0.174455E9.*((-1) ...
  .*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^( ...
  1/2))+(-0.147214E9).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*(( ...
  -1)+cos((1/45).*pi)))).^(1/2))+C1.*(0.497884E8+0.833144E2.* ...
  lambda1.^10+lambda1.^6.*(0.286096E8+(-0.13927E7).*((-1).*((-4)+ ...
  lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+ ...
  lambda1.^8.*((-0.103106E6)+0.168805E4.*((-1).*((-4)+lambda1.^2).*( ...
  2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^2.*(( ...
  -0.187616E8)+0.614331E6.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.* ...
  ((-1)+cos((1/45).*pi)))).^(1/2))+lambda1.^4.*((-0.104873E9)+ ...
  0.146009E9.*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2))+(-0.126711E9).*((-1).*((-4)+lambda1.^2).*(2+ ...
  lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))).*(0.109471E4+0.1E1.* ...
  lambda1.^4+lambda1.^2.*((-0.550023E3)+0.202612E2.*((-1).*((-4)+ ...
  lambda1.^2).*(2+lambda1.^2.*((-1)+cos((1/45).*pi)))).^(1/2))+( ...
  -0.278604E4).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2)).^(-1).*(0.412518E3+(-0.1E1).*lambda1.^2+( ...
  -0.202612E2).*((-1).*((-4)+lambda1.^2).*(2+lambda1.^2.*((-1)+cos(( ...
  1/45).*pi)))).^(1/2)).^(-2);

    case 2
%% for corrected 58,85
P_anal= lambda1.^(-3).*(C2.*(0.645074E1+(-0.168523E-4).*lambda1.^12+ ...
  lambda1.^6.*(0.542854E1+(-0.129347E1).*((2+lambda1.^2.*((-1)+cos(( ...
  1/18).*pi))).*(2+lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2))+ ...
  lambda1.^10.*(0.398746E-2+(-0.182441E-3).*((2+lambda1.^2.*((-1)+ ...
  cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2) ...
  )+lambda1.^8.*((-0.277467E0)+0.308342E-1.*((2+lambda1.^2.*((-1)+ ...
  cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2) ...
  )+lambda1.^2.*((-0.195588E1)+0.297931E0.*((2+lambda1.^2.*((-1)+ ...
  cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2) ...
  )+lambda1.^4.*((-0.142941E2)+0.926529E1.*((2+lambda1.^2.*((-1)+ ...
  cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2) ...
  )+(-0.55518E1).*((2+lambda1.^2.*((-1)+cos((1/18).*pi))).*(2+ ...
  lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2))+C1.*(0.230495E1+ ...
  0.195115E-3.*lambda1.^10+lambda1.^6.*(0.186627E1+(-0.285597E0).*(( ...
  2+lambda1.^2.*((-1)+cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin(( ...
  13/90).*pi)))).^(1/2))+lambda1.^8.*((-0.395713E-1)+0.211229E-2.*(( ...
  2+lambda1.^2.*((-1)+cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin(( ...
  13/90).*pi)))).^(1/2))+lambda1.^2.*((-0.997159E0)+0.106455E0.*((2+ ...
  lambda1.^2.*((-1)+cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin(( ...
  13/90).*pi)))).^(1/2))+lambda1.^4.*((-0.558977E1)+0.522843E1.*((2+ ...
  lambda1.^2.*((-1)+cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin(( ...
  13/90).*pi)))).^(1/2))+(-0.359838E1).*((2+lambda1.^2.*((-1)+cos(( ...
  1/18).*pi))).*(2+lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2))).*( ...
  0.156267E3+0.1E1.*lambda1.^4+lambda1.^2.*((-0.901381E2)+ ...
  0.108259E2.*((2+lambda1.^2.*((-1)+cos((1/18).*pi))).*(2+ ...
  lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2))+(-0.243957E3).*((2+ ...
  lambda1.^2.*((-1)+cos((1/18).*pi))).*(2+lambda1.^2.*((-1)+sin(( ...
  13/90).*pi)))).^(1/2)).^(-1).*(0.288411E0+(-0.42662E-2).* ...
  lambda1.^2+(-0.461855E-1).*((2+lambda1.^2.*((-1)+cos((1/18).*pi))) ...
  .*(2+lambda1.^2.*((-1)+sin((13/90).*pi)))).^(1/2)).^(-2);
end

w = sqrt(abs((-P_anal*145.08-P_exp))*abs((-P_anal*145.08-P_exp))');

end


